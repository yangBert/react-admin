{"version":3,"sources":["pages/notice/css/add.module.css","pages/notice/components/NoticeAdd.js","pages/common/layer/spinning/index.js","static/js/pagination.js","pages/notice/store/creators.js"],"names":["module","exports","NoticeAdd","state","editorState","BraftEditor","createEditorState","handleEditorChange","setState","this","props","location","editId","queryNoticeDetail","data","id","editTitle","editContent","editState","$$","trim","creater","localStorage","get","createrName","req","title","content","toHTML","saveNotice","error","className","styles","pageContet","tip","spinning","form","formLine","inline","placeholder","allowClear","onChange","e","changeEditTitle","target","value","type","button","onClick","save","to","Component","connect","notice","dispatch","action","creators","CHANGE_SPINNING","createPagination","current","pageNo","pageSize","total","totalSize","defaultPageSize","showSizeChanger","showQuickJumper","createSaveNoticeAction","spinningAction","url","requestURL","request","res","success","message","okText","onOk","history","goBack","notification","push","queryNoticelistAction","console","log","list","results","pagination","types","queryNoticeDetailAction","changeEditTitleAction","changeEditorContentAction","changeEditorStateAction","publishNoticeAction","getState","params","createChangeParamsAction"],"mappings":"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","file":"static/js/35.8485fe42.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"formLine\":\"add_formLine__DYefc\",\"inline\":\"add_inline__1PQPD\",\"form\":\"add_form__1ieqg\",\"pageContet\":\"add_pageContet__MOr1f\",\"editContent\":\"add_editContent__Qfw2w\",\"button\":\"add_button__3ltk7\"};","import React, { Component } from 'react';\r\nimport { Spin, Input, Button, message } from 'antd';\r\nimport { connect } from 'react-redux';\r\nimport * as creators from '../store/creators';\r\nimport styles from '../css/add.module.css';\r\nimport BraftEditor from 'braft-editor';\r\nimport 'braft-editor/dist/index.css';\r\nimport { Link } from 'react-router-dom';\r\nimport $$ from 'static/js/base';\r\n\r\nclass NoticeAdd extends Component {\r\n  state = {\r\n    editorState: BraftEditor.createEditorState('<p>Hello <b>World!</b></p>')\r\n  }\r\n  componentDidMount() {\r\n    this.props.handleEditorChange(BraftEditor.createEditorState('<p>Hello <b>World!</b></p>'))//初始化富文本编辑器\r\n    if (this.props.location.state && this.props.location.state.editId) {\r\n      this.props.queryNoticeDetail({ props: this.props, data: { id: this.props.location.state.editId } })\r\n    }\r\n  }\r\n\r\n  save() {\r\n    const { editTitle, editContent, editState } = this.props;\r\n    if ($$.trim(editTitle) === \"\") {\r\n      message.error('请填写公告标题');\r\n      return\r\n    } else if (editContent === \"\") {\r\n      message.error('请填公告内容');\r\n      return\r\n    }\r\n    const creater = $$.localStorage.get(\"adminId\")\r\n    const createrName = $$.localStorage.get(\"adminName\")\r\n    const req = {\r\n      props: this.props,\r\n      data: {\r\n        title: editTitle,\r\n        content: editContent.toHTML(),\r\n        creater,\r\n        createrName,\r\n        state: editState,\r\n      }\r\n    }\r\n\r\n    const editId = this.props.location.state && this.props.location.state.editId\r\n    if (editId) {\r\n      req.data.id = editId\r\n    }\r\n\r\n    this.props.saveNotice(req)\r\n  }\r\n\r\n  handleEditorChange = (editorState) => {\r\n    this.setState({\r\n      editorState: editorState,\r\n    })\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className={`${styles.pageContet} pageContentColor`}>\r\n        <Spin tip=\"Loading...\" spinning={this.props.spinning}>\r\n          <div className=\"clearfix\">\r\n            <div className={`${styles.form} pullLeft`}>\r\n              <div className={`${styles.formLine} pullLeft`}>\r\n                <label className=\"pullLeft\">公告标题:</label>\r\n                <div className={`${styles.inline} pullLeft`}>\r\n                  <Input\r\n                    placeholder=\"请输入标题\"\r\n                    allowClear\r\n                    onChange={e => this.props.changeEditTitle(e.target.value)}\r\n                    value={this.props.editTitle}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"pullRight\">\r\n              <Button type=\"primary\" className={`${styles.button}`}\r\n                onClick={() => this.save()}\r\n              >保存公告</Button>\r\n              <Link to=\"/notice/NoticeList\">\r\n                <Button className={`${styles.button}`}>返回列表</Button>\r\n              </Link>\r\n            </div>\r\n\r\n          </div>\r\n          <div className={`${styles.editContent} my-component`}>\r\n            <BraftEditor\r\n              placeholder=\"请输入正文内容\"\r\n              value={this.props.editContent}\r\n              onChange={this.props.handleEditorChange}\r\n            />\r\n          </div>\r\n        </Spin>\r\n      </div >\r\n    )\r\n  }\r\n}\r\n\r\nconst mapState = state => ({\r\n  spinning: state.notice.spinning,\r\n  editTitle: state.notice.editTitle,\r\n  editContent: state.notice.editContent,\r\n  editState: state.notice.editState,\r\n})\r\n\r\nconst mapDispatch = dispatch => ({\r\n  saveNotice: req => {\r\n    const action = creators.createSaveNoticeAction(req);\r\n    dispatch(action);\r\n  },\r\n  changeEditTitle: req => {\r\n    const action = creators.changeEditTitleAction(req);\r\n    dispatch(action);\r\n  },\r\n  handleEditorChange: editorState => {\r\n    const action = creators.changeEditorContentAction(editorState);\r\n    dispatch(action);\r\n  },\r\n  queryNoticeDetail: req => {\r\n    const action = creators.queryNoticeDetailAction(req);\r\n    dispatch(action);\r\n  },\r\n})\r\n\r\nexport default connect(mapState, mapDispatch)(NoticeAdd);","import CHANGE_SPINNING from './spinningTypes'\r\n\r\nexport default spinning => ({\r\n  type: CHANGE_SPINNING,\r\n  spinning\r\n})\r\n","export default function createPagination(data) {\r\n  return {\r\n    current: data.pageNo,\r\n    pageSize: data.pageSize,\r\n    total: data.totalSize,\r\n    defaultPageSize: 10,\r\n    showSizeChanger: true,\r\n    showQuickJumper: true\r\n  }\r\n} ","import * as types from './actionTypes';\r\nimport * as requestURL from 'static/js/requestURL';\r\nimport * as request from 'static/js/request';\r\nimport spinningAction from 'pages/common/layer/spinning';\r\nimport notification from 'pages/common/layer/notification';\r\nimport createPagination from 'static/js/pagination';\r\nimport { Modal } from 'antd'\r\nimport BraftEditor from 'braft-editor';\r\nconst initNoticeListAction = (list, pagination) => ({\r\n  type: types.QUERY_NOTICE_LIST,\r\n  list,\r\n  pagination\r\n})\r\n\r\n//保存公告\r\nconst createSaveNoticeAction = req => {\r\n  return dispatch => {\r\n    dispatch(spinningAction(true))\r\n    const url = req.data.id ? requestURL.noticeUpdateNotice : requestURL.noticeAddNotice\r\n    request.json(url, req.data, res => {\r\n      dispatch(spinningAction(false))\r\n      if (res.data) {\r\n        const { success, message } = res.data && res.data\r\n        if (success) {\r\n          Modal.success({\r\n            title: '系统提示',\r\n            content: message,\r\n            okText: '确认',\r\n            onOk: () => {\r\n              req.props.history.goBack()\r\n            }\r\n          });\r\n        } else {\r\n          notification('error', message)\r\n        }\r\n      } else {\r\n        req.props.history.push(\"/500\")\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\n//查询公告列表\r\nconst queryNoticelistAction = req => {\r\n  return dispatch => {\r\n    dispatch(spinningAction(true))\r\n    console.log(\"req.data\", req.data)\r\n    request.json(requestURL.noticeQueryByPage, req.data, res => {\r\n      dispatch(spinningAction(false))\r\n      if (res.data) {\r\n        const { success, message, data } = res.data && res.data\r\n        console.log(\"res\", res)\r\n        if (success) {\r\n          const action = initNoticeListAction(data.results, createPagination(data))\r\n          dispatch(action)\r\n        } else {\r\n          notification('error', message)\r\n        }\r\n      } else {\r\n        req.props.history.push(\"/500\")\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\n//公告详情\r\nconst queryNoticeDetailAction = req => {\r\n  return (dispatch) => {\r\n    dispatch(spinningAction(true))\r\n    request.json(requestURL.noticeGetNoticeDetail, req.data, res => {\r\n      dispatch(spinningAction(false))\r\n      if (res.data) {\r\n        const { success, message, data } = res.data && res.data\r\n        if (success) {\r\n          dispatch(changeEditTitleAction(data.title))\r\n          dispatch(changeEditorContentAction(BraftEditor.createEditorState(data.content)))\r\n          dispatch(changeEditorStateAction(data.state))\r\n        } else {\r\n          notification('error', message)\r\n        }\r\n      } else {\r\n        req.props.history.push(\"/500\")\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\n//发布公告\r\nconst publishNoticeAction = req => {\r\n  return (dispatch, getState) => {\r\n    dispatch(spinningAction(true))\r\n    request.json(requestURL.noticePublishNotice, req.data, res => {\r\n      dispatch(spinningAction(false))\r\n      if (res.data) {\r\n        const { success, message } = res.data && res.data\r\n        if (success) {\r\n          Modal.success({\r\n            title: '系统提示',\r\n            content: message,\r\n            okText: '确认',\r\n            onOk: () => {\r\n              const pagination = getState().notice.pagination\r\n              const params = {\r\n                ...getState().notice.params,\r\n                pageNo: pagination.current,\r\n                pageSize: pagination.pageSize,\r\n              }\r\n              dispatch(queryNoticelistAction({ props: req.props, data: params }));\r\n            }\r\n          });\r\n        } else {\r\n          notification('error', message)\r\n        }\r\n      } else {\r\n        req.props.history.push(\"/500\")\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\n//查询携带参数\r\nconst createChangeParamsAction = params => ({\r\n  type: types.CHANGE_SEARCH_PARAMS,\r\n  params\r\n})\r\n\r\n//编辑改变标题\r\nconst changeEditTitleAction = editTitle => ({\r\n  type: types.CHANGE_EDIT_TITLE,\r\n  editTitle\r\n})\r\n\r\n//编辑改变富文本内容\r\nconst changeEditorContentAction = editContent => ({\r\n  type: types.CHANGE_EDIT_CONTENT,\r\n  editContent\r\n})\r\n\r\n//编辑改变富文本内容\r\nconst changeEditorStateAction = editState => ({\r\n  type: types.CHANGE_EDIT_STATE,\r\n  editState\r\n})\r\n\r\n\r\nexport {\r\n  queryNoticelistAction,\r\n  createSaveNoticeAction,\r\n  createChangeParamsAction,\r\n  changeEditTitleAction,\r\n  changeEditorContentAction,\r\n  queryNoticeDetailAction,\r\n  publishNoticeAction,\r\n}"],"sourceRoot":""}